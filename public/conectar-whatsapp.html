<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Conectar WhatsApp ‚Äì ComercioAI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://raw.githubusercontent.com/GOGOSCHNO/assistantai-site/refs/heads/main/images/favicon%20(2).png">
  <link rel="stylesheet" href="comercioai.css">
</head>
<body>
  <!-- === Header commun === -->
  <header class="ca-header">
    <div class="ca-header-3col">
      <div class="ca-header-left">
        <a href="index.html" class="ca-logo-icon">
          <img src="https://raw.githubusercontent.com/GOGOSCHNO/assistantai-site/refs/heads/main/images/favicon%20(2).png" alt="Logo Cerveau">
        </a>
        <a href="index.html" class="ca-logo-text-img">
          <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/ComercioAI_logotexte%20sans%20fonds.png" alt="Logo ComercioAI">
        </a>
      </div>
      <nav class="ca-header-center" id="nav-center"></nav>
      <div id="auth-buttons" class="nav-login"></div>
    </div>
    <!-- Version mobile -->
    <div class="ca-header-mobile">
      <div class="ca-header-left">
        <a href="index.html" class="ca-logo-icon">
          <img src="https://raw.githubusercontent.com/GOGOSCHNO/assistantai-site/refs/heads/main/images/favicon%20(2).png" alt="Logo Cerveau">
        </a>
        <a href="index.html" class="ca-logo-text-img">
          <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/ComercioAI_logotexte%20sans%20fonds.png" alt="Logo ComercioAI">
        </a>
      </div>
      <div class="ca-header-mobile-actions" id="mobile-actions"></div>
      <button class="ca-hamburger" id="caHamburgerBtn" aria-label="Menu">
        <span></span><span></span><span></span>
      </button>
    </div>
    <nav class="ca-mobile-menu" id="caMobileMenu"></nav>
  </header>

  <!-- === Contenu principal === -->
  <main class="ca-main">
    <section class="ca-section">
      <h1>Conectar WhatsApp</h1>
      <p class="ca-subtext">Conecta tu n√∫mero de WhatsApp API para activar las respuestas autom√°ticas de tu asistente.</p>

      <!-- Carte de status -->
      <div class="ca-card" id="statusCard">
        <h3>Estado de conexi√≥n</h3>
        <p id="statusText">Cargando...</p>
      </div>
    </section>
    
    <button id="btnEmbedded" class="ca-btn ca-btn-primary">Iniciar Embedded Signup</button>
  </main>

  <!-- === Footer commun === -->
  <footer class="ca-footer">
    &copy; 2025 ComercioAI ‚Äì Todos los derechos reservados.
    <a href="contacto.html">Cont√°ctanos</a>
    <a href="politica-de-privacidad.html" target="_blank">Pol√≠tica de Privacidad</a>
    <a href="eliminar-datos.html" target="_blank">Eliminar mis datos</a>
  </footer>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const $ = (id) => document.getElementById(id);
  
    // --- Auth header ---
    (async function initHeaderAuth() {
      try {
        const res = await fetch('/api/me', { credentials: 'include' });
        const box = $('auth-buttons');
        if (res.ok) {
          const me = await res.json();
          if (box) box.innerHTML = `üëã Hola, ${me.name || me.email}`;
        } else {
          if (box) box.innerHTML = `<a href="login.html" class="ca-btn">Iniciar sesi√≥n</a>`;
        }
      } catch {}
    })();
  
    // --- Embedded Signup ---
    const btnEmbedded = $('btnEmbedded');
    if (btnEmbedded) {
      btnEmbedded.addEventListener('click', async () => {
        try {
          const r = await fetch('/api/whatsapp/embedded/start', { credentials:'include' });
          if (!r.ok) return alert('No se pudo iniciar ESU');
          const { url } = await r.json();
          window.location.href = url;
        } catch {
          alert('Error iniciando ESU');
        }
      });
    }
  });
  </script>
  <script>
    async function refreshStatus(){
      try{
        const r = await fetch('/api/whatsapp/status', { credentials:'include' });
        const s = await r.json();
        const txt = s.connected
          ? `‚úÖ Conectado (producci√≥n) ‚Äì phone_number_id: ${s.phoneNumberIdMasked || '‚Äî'}`
          : '‚ùå No conectado';
        const el = document.getElementById('statusText');
        if (el) el.textContent = txt;
      }catch{
        const el = document.getElementById('statusText');
        if (el) el.textContent = 'Error al cargar estado.';
      }
    }
    document.addEventListener('DOMContentLoaded', refreshStatus);
  </script>
</body>
</html>












