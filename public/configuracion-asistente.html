<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Configuraci√≥n del Asistente ‚Äì Comercio AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="comercioai.css">
  <link rel="icon" href="https://raw.githubusercontent.com/GOGOSCHNO/assistantai-site/refs/heads/main/images/favicon%20(2).png" type="image/x-icon">
</head>
<body>
  <div class="overlay">
    <header class="ca-header">
      <div class="ca-header-3col">
        <div class="ca-header-left">
          <a href="index.html" class="ca-logo-icon">
            <img src="https://raw.githubusercontent.com/GOGOSCHNO/assistantai-site/refs/heads/main/images/favicon%20(2).png" alt="Logo Cerveau">
          </a>
          <a href="index.html" class="ca-logo-text-img">
            <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/ComercioAI_logotexte%20sans%20fonds.png" alt="Logo ComercioAI">
          </a>
        </div>
        <nav class="ca-header-center" id="nav-center">
          <a href="precio.html" class="ca-btn nav-btn">Ver planes</a>
          <a href="dashboard.html" class="ca-btn ca-btn-primary">Dashboard</a>
        </nav>
        <div id="auth-buttons" class="ca-header-right"></div>
      </div>
    </header>
    <main>
      <div id="progress-bar-container">
        <div id="progress-bar"></div>
      </div>
      <div class="form-container">
        <h2>‚öôÔ∏è Configuraci√≥n del asistente</h2>
    
        <!-- √âtape 0 : Choix entre MayIA et SofIA -->
        <div class="form-step" id="step0">
          <h2>¬øCu√°l asistente deseas usar?</h2>
          <div class="assistant-selection">
            <div class="assistant-option" id="mayia">
              <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/patricia%20feliz.png" alt="MayIA">
              <h3>MayIA</h3>
              <p>Ideal para negocios de productos f√≠sicos o digitales.</p>
            </div>
            <div class="assistant-option" id="sofia">
              <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/Clara.png" alt="SofIA">
              <h3>SofIA</h3>
              <p>Perfecta para servicios como belleza, salud, reservas‚Ä¶</p>
            </div>
          </div>
        </div>
    
        <!-- √âtape dynamique -->
        <div id="dynamic-form-container"></div>
      </div>
    </main>
    <footer class="ca-footer">
      &copy; 2025 Comercio AI ‚Äì Todos los derechos reservados.
      <a href="contacto.html">Cont√°ctanos</a>
      <a href="politica-de-privacidad.html" target="_blank">Pol√≠tica de Privacidad</a>
    </footer>
  </div>
  <script>
  let currentStep = 0;
  let selectedAssistant = null;
  const progressBar = document.getElementById("progress-bar");
  const dynamicContainer = document.getElementById("dynamic-form-container");
  
  function updateProgressBar(stepIndex) {
    const percent = Math.min((stepIndex / 4) * 100, 100);
    progressBar.style.width = `${percent}%`;
  }
  
  function showStep0() {
    document.getElementById("step0").style.display = "block";
    dynamicContainer.innerHTML = "";
    updateProgressBar(0);
  }
  
  function loadFormForMayIA() {
    dynamicContainer.innerHTML = `
      <h3>Informaci√≥n b√°sica sobre tu tienda</h3>
  
      <label>Nombre del negocio</label>
      <input type="text" id="nombreNegocioMayIA" placeholder="Ej: Tienda El Rinc√≥n" />
  
      <label>¬øQu√© tipo de productos vendes?</label>
      <input type="text" id="productosVendidos" placeholder="Ej: Cosm√©ticos, electrodom√©sticos, comida r√°pida‚Ä¶" />
  
      <label>¬øQu√© tipo de tienda tienes?</label>
      <div class="assistant-selection" id="tipoTiendaSeleccion">
        <div class="assistant-option" data-tipo="fisica">
          <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/tiendafisica.png" alt="Tienda f√≠sica">
          <h4>Tienda f√≠sica</h4>
        </div>
        <div class="assistant-option" data-tipo="linea">
          <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/tiendalinea.png" alt="Tienda en l√≠nea">
          <h4>Tienda en l√≠nea</h4>
        </div>
        <div class="assistant-option" data-tipo="mixta">
          <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/tiendalosdos.png" alt="Ambos">
          <h4>Ambos</h4>
        </div>
      </div>
  
      <div id="ciudadContainer" style="display:none;">
        <label>Ciudad(es) donde operas</label>
        <input type="text" id="ciudadMayIA" placeholder="Ej: Medell√≠n, Bogot√°" />
      </div>

      <button class="btn ca-btn-outline" onclick="volverPaso0()">‚Üê Regresar</button>
      <button class="btn" onclick="siguientePaso()">Siguiente</button>
    `;
  
    currentStep = 1;
    updateProgressBar(currentStep);
  
    // Gestion du clic sur type de tienda
    document.querySelectorAll('#tipoTiendaSeleccion .assistant-option').forEach(option => {
      option.addEventListener('click', () => {
        document.querySelectorAll('#tipoTiendaSeleccion .assistant-option').forEach(el => el.classList.remove('selected'));
        option.classList.add('selected');
        const tipoSeleccionado = option.getAttribute("data-tipo");
  
        // Affiche le champ ciudad sauf si tienda en l√≠nea
        const ciudadDiv = document.getElementById("ciudadContainer");
        ciudadDiv.style.display = (tipoSeleccionado === "linea") ? "none" : "block";
  
        // Stocker pour traitement final plus tard
        window.tipoTiendaMayIA = tipoSeleccionado;
      });
    });
  }
  
  function loadFormForSofIA() {
    dynamicContainer.innerHTML = `
      <h3>Informaci√≥n b√°sica sobre tu servicio</h3>
      <label>Nombre del negocio</label>
      <input type="text" id="nombreNegocioSofIA" placeholder="Ej: Est√©tica Sofi Belleza" />
  
      <label>¬øQu√© servicios ofreces?</label>
      <input type="text" id="serviciosOfrecidos" placeholder="Ej: U√±as, pesta√±as, masajes, reservas‚Ä¶" />
  
      <label>Ciudad donde operas</label>
      <input type="text" id="ciudadSofIA" placeholder="Ej: Barranquilla, Cali" />
  
      <button class="btn" onclick="siguientePaso()">Siguiente</button>
    `;
    currentStep = 1;
    updateProgressBar(currentStep);
  }
  
  function siguientePaso() {
    if (currentStep === 1) {
      currentStep = 2;
      updateProgressBar(currentStep);
  
      const esMayIA = selectedAssistant === "mayia";
  
      const objetivosHTML = esMayIA
        ? `
          <label><input type="checkbox" class="objetivo" value="Responder preguntas sobre productos" /> Responder preguntas sobre productos</label>
          <label><input type="checkbox" class="objetivo" value="Promocionar nuevos productos" /> Promocionar nuevos productos</label>
          <label><input type="checkbox" class="objetivo" value="Guiar al cliente hacia la compra" /> Guiar al cliente hacia la compra</label>
          <label><input type="checkbox" class="objetivo" value="Enviar enlaces a tienda virtual" /> Enviar enlaces a tienda virtual</label>
          <label><input type="checkbox" class="objetivo" value="Compartir precios y formas de pago" /> Compartir precios y formas de pago</label>
          <label><input type="checkbox" class="objetivo" value="Ofrecer recomendaciones de productos" /> Ofrecer recomendaciones de productos</label>
        `
        : `
          <label><input type="checkbox" class="objetivo" value="Responder dudas sobre servicios" /> Responder dudas sobre servicios</label>
          <label><input type="checkbox" class="objetivo" value="Automatizar reservas o agendamientos" /> Automatizar reservas o agendamientos</label>
          <label><input type="checkbox" class="objetivo" value="Confirmar citas autom√°ticamente" /> Confirmar citas autom√°ticamente</label>
          <label><input type="checkbox" class="objetivo" value="Guiar al cliente al contacto por WhatsApp" /> Guiar al cliente al contacto por WhatsApp</label>
          <label><input type="checkbox" class="objetivo" value="Promover servicios destacados" /> Promover servicios destacados</label>
          <label><input type="checkbox" class="objetivo" value="Reducir el trabajo del equipo humano" /> Reducir el trabajo del equipo humano</label>
        `;
  
      dynamicContainer.innerHTML = `
        <h3>üéØ ¬øCu√°les son los objetivos de tu asistente?</h3>
        <p>Selecciona los objetivos que deseas lograr con <strong>${esMayIA ? 'MayIA' : 'SofIA'}</strong>:</p>
  
        ${objetivosHTML}
  
        <label>
          <input type="checkbox" id="chkOtro" />
          Otro:
          <input type="text" id="inputOtro" placeholder="Especifica tu objetivo" style="margin-left:10px;" />
        </label>
  
        <button class="btn" onclick="siguientePaso()">Siguiente</button>
      `;
    }
  
    // Tu pourras ensuite ajouter ici le bloc `if (currentStep === 2)` pour l‚Äô√©tape suivante (style de communication, FAQ, etc.)
  }
    
  function volverPaso0() {
    currentStep = 0;
    selectedAssistant = null;
    document.getElementById("step0").style.display = "block";
    dynamicContainer.innerHTML = "";
    updateProgressBar(0);
  }
    
  // V√©rif auth
  window.addEventListener("DOMContentLoaded", async () => {
    try {
      const res = await fetch("/api/me", { credentials: "include" });
      if (!res.ok) throw new Error("No autenticado");
      const data = await res.json();
      document.getElementById("auth-buttons").innerHTML = `üëã Hola, ${data.name}`;
      showStep0();
  
      // üîÅ Ajoute ceci
      document.getElementById("mayia").addEventListener("click", () => {
        selectedAssistant = "mayia";
        document.getElementById("mayia").classList.add("selected");
        document.getElementById("sofia").classList.remove("selected");
      
        // Masquer l‚Äô√©tape 0
        document.getElementById("step0").style.display = "none";
      
        loadFormForMayIA();
      });
      
      document.getElementById("sofia").addEventListener("click", () => {
        selectedAssistant = "sofia";
        document.getElementById("sofia").classList.add("selected");
        document.getElementById("mayia").classList.remove("selected");
      
        // Masquer l‚Äô√©tape 0
        document.getElementById("step0").style.display = "none";
      
        loadFormForSofIA();
      });
  
    } catch (err) {
      window.location.href = "login.html";
    }
  });
  </script>
  <script>
    document.getElementById("generarInstruccionesBtn").addEventListener("click", async () => {
      // 1. R√©cup√©ration des champs Section I
      const nombre = document.getElementById("nombreNegocio").value.trim();
      const tipo = document.getElementById("tipoNegocio").value.trim();
      const venta = document.querySelector('input[name="tipoVenta"]:checked')?.value || "";
      const especialidad = document.getElementById("especializacion").value.trim();
      const clientes = document.querySelector('input[name="tipoCliente"]:checked')?.value || "";
      const ciudad = document.getElementById("ciudad").value.trim();
  
      const objetivos = Array.from(document.querySelectorAll('.objetivo:checked')).map(el => el.value);
      if (chkOtro.checked && inputOtro.value.trim()) {
        objetivos.push(inputOtro.value.trim());
      }
  
      const tono = document.getElementById("tono").value.trim();
      const estilo = document.getElementById("ejemploEstilo").value.trim();
  
      // 2. Section II ‚Äì FAQ
      const faqPairs = Array.from(document.querySelectorAll(".faq-item")).map(faq => {
        const q = faq.querySelector(".faq-pregunta")?.value.trim();
        const a = faq.querySelector(".faq-respuesta")?.value.trim();
        return q && a ? `- ${q}\n  ‚Üí ${a}` : null;
      }).filter(Boolean);
  
      // 3. Section III
      const productos = document.getElementById("productosList").value.trim().split("\n").filter(Boolean).map(p => `- ${p}`).join("\n");
      const horarios = [
        `Lunes: ${document.getElementById("lunes").value.trim()}`,
        `Martes: ${document.getElementById("martes").value.trim()}`,
        `Mi√©rcoles: ${document.getElementById("miercoles").value.trim()}`,
        `Jueves: ${document.getElementById("jueves").value.trim()}`,
        `Viernes: ${document.getElementById("viernes").value.trim()}`,
        `S√°bado: ${document.getElementById("sabado").value.trim()}`,
        `Domingo: ${document.getElementById("domingo").value.trim()}`,
      ].join("\n");
      const festivos = document.getElementById("trabajaFestivos").checked;
  
      const web = document.getElementById("paginaWeb").value.trim();
      const whatsapp = document.getElementById("whatsapp").value.trim();
  
      // 4. Construction du prompt
      const textoFinal = `
  I/ Informaci√≥n del Asistente
  I.i/ Contexto
  ${nombre} es un negocio de ${tipo} y que vende ${venta}. 
  ${nombre} est√° especializado en la venta de ${especialidad}.
  Los clientes son principalmente ${clientes}.
  ${nombre} se encuentra en ${ciudad}.
  
  I.ii/ Objetivos
  Los objetivos principales de ${nombre} son:
  ${objetivos.map(o => "- " + o).join("\n")}
  
  I.iii/ Estilo de comunicaci√≥n
  El estilo de comunicaci√≥n de ${nombre} es:
  Tono: ${tono}
  Ejemplo: ${estilo}
  
  II/ Funciones
  II.i/ Preguntas frecuentes
  ${faqPairs.join("\n")}
  
  III/ Informaci√≥n del comercio
  III.i/ Informaci√≥n de los ${venta}
  ${productos}
  
  III.ii/ Horarios
  ${horarios}
  ${nombre} ${festivos ? "s√≠" : "no"} est√° abierto en d√≠as festivos.
  
  III.iii/ Contactos
  La p√°gina web principal es: ${web}
  El n√∫mero de WhatsApp es: ${whatsapp}
  
  IV/ Notas Internas para Clasificaci√≥n de Conversaciones
  Despu√©s de cada respuesta dirigida al cliente, debes agregar una nota interna de toda la conversaci√≥n estructurada que no ser√° visible para el cliente, pero ser√° utilizada para clasificar la conversaci√≥n en el sistema de Dolcezza.
  Esta nota debe seguir el siguiente formato exacto:
  
  --- Nota interna ---
  Resumen: [Una frase breve que resuma el prop√≥sito de la conversaci√≥n]
  Estado: [Una de las siguientes opciones: Acci√≥n requerida / Nada que hacer / Conversaci√≥n informativa / Potencial cliente / Seguimiento recomendado]
  ---------------------
  
  üìå Importante: Esta nota debe ir al final del mensaje, despu√©s de responder al cliente.
  ‚ö†Ô∏è No incluyas esta nota en el mensaje de WhatsApp al cliente. El sistema la detectar√° autom√°ticamente para uso interno.
      `.trim();
  
      // 5. Envoi au backend
      const res = await fetch("/api/configurar-instrucciones", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ instructions: textoFinal })
      });
  
      if (res.ok) {
        alert("‚úÖ Instrucciones actualizadas correctamente en tu asistente.");
      } else {
        alert("‚ùå Error al guardar las instrucciones.");
      }
    });
  </script>
</body>
</html>
