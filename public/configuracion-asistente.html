<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Configuraci√≥n del Asistente ‚Äì Comercio AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="comercioai.css">
  <link rel="icon" href="https://raw.githubusercontent.com/GOGOSCHNO/assistantai-site/refs/heads/main/images/favicon%20(2).png" type="image/x-icon">
</head>
<body>
  <div class="overlay">
    <header class="ca-header">
      <div class="ca-header-3col">
        <div class="ca-header-left">
          <a href="index.html" class="ca-logo-icon">
            <img src="https://raw.githubusercontent.com/GOGOSCHNO/assistantai-site/refs/heads/main/images/favicon%20(2).png" alt="Logo Cerveau">
          </a>
          <a href="index.html" class="ca-logo-text-img">
            <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/ComercioAI_logotexte%20sans%20fonds.png" alt="Logo ComercioAI">
          </a>
        </div>
        <nav class="ca-header-center" id="nav-center">
          <a href="precio.html" class="ca-btn nav-btn">Ver planes</a>
          <a href="dashboard.html" class="ca-btn ca-btn-primary">Dashboard</a>
        </nav>
        <div id="auth-buttons" class="ca-header-right"></div>
      </div>
    </header>
    <main>
      <div id="progress-bar-container">
        <div id="progress-bar"></div>
      </div>
      <div class="form-container">
        <h2>‚öôÔ∏è Configuraci√≥n del asistente</h2>
    
        <!-- √âtape 0 : Choix entre MayIA et SofIA -->
        <div class="form-step" id="step0">
          <h2>¬øCu√°l asistente deseas usar?</h2>
          <div class="assistant-selection">
            <div class="assistant-option" id="mayia">
              <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/patricia%20feliz.png" alt="MayIA">
              <h3>MayIA</h3>
              <p>Ideal para negocios de productos f√≠sicos o digitales.</p>
            </div>
            <div class="assistant-option" id="sofia">
              <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/Clara.png" alt="SofIA">
              <h3>SofIA</h3>
              <p>Perfecta para servicios como belleza, salud, reservas‚Ä¶</p>
            </div>
          </div>
        </div>
    
        <!-- √âtape dynamique -->
        <div id="dynamic-form-container"></div>
      </div>
    </main>
    <footer class="ca-footer">
      &copy; 2025 Comercio AI ‚Äì Todos los derechos reservados.
      <a href="contacto.html">Cont√°ctanos</a>
      <a href="politica-de-privacidad.html" target="_blank">Pol√≠tica de Privacidad</a>
    </footer>
  </div>
  <script>
  let datosFormulario = {
    nombre: "",
    tipo: "",
    venta: "",
    especialidad: "",
    clientes: "",
    ciudad: "",
    objetivos: [],
    tono: "",
    estilo: "",
    faq: [],
    productos: [],
    horarios: {
      lunes: "", martes: "", miercoles: "", jueves: "", viernes: "", sabado: "", domingo: ""
    },
    festivos: false,
    web: "",
    whatsapp: ""
  };
  let camposExtra = [];

  function agregarCampoExtra() {
    const nombreCampo = prompt("Nombre del nuevo campo (ej: Duraci√≥n, Categor√≠a):");
    if (nombreCampo) {
      camposExtra.push(nombreCampo);
      actualizarCamposProducto(document.querySelector(".producto-item:last-child"));
    }
  }
  
  function actualizarCamposProducto(contenedor) {
    camposExtra.forEach(campo => {
      const label = document.createElement("label");
      label.textContent = campo;
      const input = document.createElement("input");
      input.type = "text";
      input.className = `producto-${campo.toLowerCase()}`;
      input.placeholder = `Ej: valor para ${campo}`;
      contenedor.appendChild(label);
      contenedor.appendChild(input);
    });
  }
  let currentStep = 0;
  let selectedAssistant = null;
  const progressBar = document.getElementById("progress-bar");
  const dynamicContainer = document.getElementById("dynamic-form-container");
  
  function updateProgressBar(stepIndex) {
    const percent = Math.min((stepIndex / 4) * 100, 100);
    progressBar.style.width = `${percent}%`;
  }
  
  function showStep0() {
    document.getElementById("step0").style.display = "block";
    dynamicContainer.innerHTML = "";
    updateProgressBar(0);
  }
  
  function loadFormForMayIA() {
    dynamicContainer.innerHTML = `
      <h3>Informaci√≥n b√°sica sobre tu tienda</h3>
  
      <label>Nombre del negocio</label>
      <input type="text" id="nombreNegocioMayIA" placeholder="Ej: Tienda El Rinc√≥n" />
  
      <label>¬øQu√© tipo de productos vendes?</label>
      <input type="text" id="productosVendidos" placeholder="Ej: Cosm√©ticos, electrodom√©sticos, comida r√°pida‚Ä¶" />
  
      <label>¬øQu√© tipo de tienda tienes?</label>
      <div class="assistant-selection" id="tipoTiendaSeleccion">
        <div class="assistant-option" data-tipo="fisica">
          <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/tiendafisica.png" alt="Tienda f√≠sica">
          <h4>Tienda f√≠sica</h4>
        </div>
        <div class="assistant-option" data-tipo="linea">
          <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/tiendalinea.png" alt="Tienda en l√≠nea">
          <h4>Tienda en l√≠nea</h4>
        </div>
        <div class="assistant-option" data-tipo="mixta">
          <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/tiendalosdos.png" alt="Ambos">
          <h4>Ambos</h4>
        </div>
      </div>
  
      <div id="ciudadContainer" style="display:none;">
        <label>Ciudad(es) donde operas</label>
        <input type="text" id="ciudadMayIA" placeholder="Ej: Medell√≠n, Bogot√°" />
      </div>

      <button class="btn ca-btn-outline" onclick="volverPaso0()">‚Üê Regresar</button>
      <button class="btn" onclick="siguientePaso()">Siguiente</button>
    `;
  
    currentStep = 1;
    updateProgressBar(currentStep);
  
    // Gestion du clic sur type de tienda
    document.querySelectorAll('#tipoTiendaSeleccion .assistant-option').forEach(option => {
      option.addEventListener('click', () => {
        document.querySelectorAll('#tipoTiendaSeleccion .assistant-option').forEach(el => el.classList.remove('selected'));
        option.classList.add('selected');
        const tipoSeleccionado = option.getAttribute("data-tipo");
  
        // Affiche le champ ciudad sauf si tienda en l√≠nea
        const ciudadDiv = document.getElementById("ciudadContainer");
        ciudadDiv.style.display = (tipoSeleccionado === "linea") ? "none" : "block";
  
        // Stocker pour traitement final plus tard
        window.tipoTiendaMayIA = tipoSeleccionado;
      });
    });
  }
  
  function loadFormForSofIA() {
    dynamicContainer.innerHTML = `
      <h3>Informaci√≥n b√°sica sobre tu servicio</h3>
      <label>Nombre del negocio</label>
      <input type="text" id="nombreNegocioSofIA" placeholder="Ej: Est√©tica Sofi Belleza" />
  
      <label>¬øQu√© servicios ofreces?</label>
      <input type="text" id="serviciosOfrecidos" placeholder="Ej: U√±as, pesta√±as, masajes, reservas‚Ä¶" />
  
      <label>Ciudad donde operas</label>
      <input type="text" id="ciudadSofIA" placeholder="Ej: Barranquilla, Cali" />

      <button class="btn ca-btn-outline" onclick="volverPaso0()">‚Üê Regresar</button>
      <button class="btn" onclick="siguientePaso()">Siguiente</button>
    `;
    currentStep = 1;
    updateProgressBar(currentStep);
  }
  
  function siguientePaso() {
    if (currentStep === 1) {
      // √âtape 1 ‚Äì Infos g√©n√©rales (adapt√©e selon l'assistant)
      if (selectedAssistant === "mayia") {
        datosFormulario.nombre = document.getElementById("nombreNegocioMayIA")?.value?.trim() || "";
        datosFormulario.venta = document.getElementById("productosVendidos")?.value?.trim() || "";
        datosFormulario.tipo = window.tipoTiendaMayIA || "";
        datosFormulario.ciudad = document.getElementById("ciudadMayIA")?.value?.trim() || "";
      } else if (selectedAssistant === "sofia") {
        datosFormulario.nombre = document.getElementById("nombreNegocioSofIA")?.value?.trim() || "";
        datosFormulario.servicios = document.getElementById("serviciosOfrecidos")?.value?.trim() || "";
        datosFormulario.ciudad = document.getElementById("ciudadSofIA")?.value?.trim() || "";
      }
  
      currentStep = 2;
      updateProgressBar(currentStep);
  
      const esMayIA = selectedAssistant === "mayia";
      const objetivos = esMayIA
        ? [
            "Responder preguntas sobre productos",
            "Promocionar nuevos productos",
            "Guiar al cliente hacia la compra",
            "Enviar enlaces a tienda virtual",
            "Compartir precios y formas de pago",
            "Ofrecer recomendaciones de productos"
          ]
        : [
            "Responder dudas sobre servicios",
            "Automatizar reservas o agendamientos",
            "Confirmar citas autom√°ticamente",
            "Guiar al cliente al contacto por WhatsApp",
            "Promover servicios destacados",
            "Reducir el trabajo del equipo humano"
          ];
  
      dynamicContainer.innerHTML = `
        <h3>üéØ ¬øCu√°les son los objetivos de tu asistente?</h3>
        <p>Selecciona los objetivos que deseas lograr con <strong>${esMayIA ? "MayIA" : "SofIA"}</strong>:</p>
        <div class="objetivo-selection">
          ${objetivos.map(obj => `<div class="objetivo-option">${obj}</div>`).join("")}
        </div>
        <label style="margin-top: 20px; display: block;">
          Otro objetivo:
          <input type="text" id="inputOtro" placeholder="Especifica tu objetivo" />
        </label>
        <div style="margin-top: 30px;">
          <button class="btn ca-btn-outline" onclick="volverPaso1()">‚Üê Regresar</button>
          <button class="btn" onclick="siguientePaso()">Siguiente</button>
        </div>
      `;
  
      document.querySelectorAll(".objetivo-option").forEach((opt) => {
        opt.addEventListener("click", () => opt.classList.toggle("selected"));
      });
    }
  
    else if (currentStep === 2) {
      // √âtape 2 ‚Äì Objectifs, style, FAQ rapide
      const objetivosSeleccionados = Array.from(document.querySelectorAll(".objetivo-option.selected"))
        .map(el => el.textContent.trim());
  
      const inputOtro = document.getElementById("inputOtro");
      if (inputOtro?.value?.trim()) {
        objetivosSeleccionados.push(inputOtro.value.trim());
      }
  
      datosFormulario.objetivos = objetivosSeleccionados;
      datosFormulario.tono = document.getElementById("tono")?.value?.trim() || "";
      datosFormulario.ejemplo = document.getElementById("ejemplo")?.value?.trim() || "";
  
      const preguntas = document.getElementById("preguntas")?.value?.trim() || "";
      datosFormulario.preguntas = preguntas.split("\n").filter(p => p.trim());
  
      currentStep = 3;
      updateProgressBar(currentStep);
  
      dynamicContainer.innerHTML = `
        <h3>‚ùì Preguntas frecuentes (FAQ)</h3>
        <p>A√±ade las preguntas que suelen hacer tus clientes y c√≥mo deseas que el asistente responda.</p>
        <div id="faqContainer">
          <div class="faq-item">
            <label>Pregunta</label>
            <input type="text" class="faq-pregunta" placeholder="Ej: ¬øCu√°nto cuesta el env√≠o?" />
            <label>Respuesta</label>
            <input type="text" class="faq-respuesta" placeholder="Ej: El env√≠o cuesta entre $8.000 y $12.000 seg√∫n tu ciudad." />
          </div>
        </div>
        <button class="btn ca-btn-outline" onclick="agregarFaq()">‚ûï A√±adir otra pregunta</button>
        <div style="margin-top: 30px;">
          <button class="btn ca-btn-outline" onclick="volverPaso2()">‚Üê Regresar</button>
          <button class="btn" onclick="siguientePaso()">Siguiente</button>
        </div>
      `;
    }
  
    else if (currentStep === 3) {
      // √âtape 3 ‚Äì Produits/Services, horaires, contact
      const servicios = document.querySelectorAll(".servicio");
      datosFormulario.servicios = [];
      servicios.forEach(serv => {
        const nombre = serv.querySelector(".nombre-servicio")?.value?.trim() || "";
        const precio = serv.querySelector(".precio-servicio")?.value?.trim() || "";
        const descripcion = serv.querySelector(".descripcion-servicio")?.value?.trim() || "";
        if (nombre) {
          datosFormulario.servicios.push({ nombre, precio, descripcion });
        }
      });
  
      const dias = ["lunes", "martes", "miercoles", "jueves", "viernes", "sabado", "domingo"];
      datosFormulario.horarios = {};
      dias.forEach(dia => {
        const input = document.getElementById(dia);
        datosFormulario.horarios[dia] = input?.value?.trim() || "No definido";
      });
  
      const chkFestivo = document.getElementById("chkFestivo") || document.getElementById("trabajaFestivos");
      datosFormulario.diasFestivos = chkFestivo?.checked || false;
  
      datosFormulario.contacto = {
        whatsapp: document.getElementById("whatsapp")?.value?.trim() || "",
        email: document.getElementById("email")?.value?.trim() || "",
        sitioWeb: document.getElementById("web")?.value?.trim() || ""
      };
  
      currentStep = 4;
      updateProgressBar(currentStep);
  
      dynamicContainer.innerHTML = `
        <h3>üè™ Informaci√≥n del comercio</h3>
        <div id="productosServiciosContainer">
          <h4>Productos o servicios</h4>
          <div class="producto-item">
            <label>Nombre</label>
            <input type="text" class="producto-nombre" placeholder="Ej: Facial hidratante, Hamburguesa..." />
            <label>Precio</label>
            <input type="text" class="producto-precio" placeholder="Ej: $35.000" />
            <label>Descripci√≥n</label>
            <input type="text" class="producto-descripcion" placeholder="Ej: Limpieza profunda y masaje facial" />
          </div>
        </div>
        <button class="btn ca-btn-outline" onclick="agregarCampoExtra()">‚ûï A√±adir campo personalizado</button>
        <button class="btn ca-btn-outline" onclick="agregarProducto()">‚ûï A√±adir otro producto o servicio</button>
  
        <div class="form-subsection">
          <h4>‚è∞ Horarios de atenci√≥n</h4>
          ${["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado", "Domingo"].map(dia => `
            <label>${dia}</label>
            <input type="text" id="${dia.toLowerCase()}" placeholder="Ej: 9:00 - 18:00 o Cerrado" />
          `).join("")}
          <label>
            <input type="checkbox" id="trabajaFestivos" />
            ¬øTu negocio abre en d√≠as festivos?
          </label>
        </div>
  
        <div class="form-subsection">
          <h4>üìû Informaci√≥n de contacto</h4>
          <label>WhatsApp</label>
          <input type="text" id="whatsapp" placeholder="Ej: +57 3001234567" />
          <label>Email</label>
          <input type="text" id="email" placeholder="Ej: contacto@tu-negocio.com" />
          <label>Sitio web</label>
          <input type="text" id="web" placeholder="Ej: www.tu-negocio.com" />
        </div>
  
        <div style="margin-top: 30px;">
          <button class="btn ca-btn-outline" onclick="volverPaso3()">‚Üê Regresar</button>
          <button class="btn" onclick="finalizarFormulario()">Finalizar configuraci√≥n</button>
        </div>
      `;
    }
  }

  function repliegueUltimoProducto() {
    const items = document.querySelectorAll("#productosServiciosContainer .producto-item");
    const dernier = items[items.length - 1];
  
    const nombre = dernier.querySelector(".producto-nombre")?.value || "";
    const precio = dernier.querySelector(".producto-precio")?.value || "";
    const descripcion = dernier.querySelector(".producto-descripcion")?.value || "";
  
    const resumen = document.createElement("div");
    resumen.classList.add("producto-resumen");
    resumen.innerHTML = `
      <p><strong>${nombre}</strong> ‚Äì ${precio}</p>
      <p>${descripcion}</p>
    `;
  
    // Supprimer le formulaire et garder le r√©sum√©
    dernier.innerHTML = "";
    dernier.classList.add("producto-replegado");
    // üîß Correction ici
    dernier.appendChild(resumen);
  }
    
  function volverPaso0() {
    currentStep = 0;
    selectedAssistant = null;
    document.getElementById("step0").style.display = "block";
    dynamicContainer.innerHTML = "";
    updateProgressBar(0);
  }
  function volverPaso1() {
    currentStep = 1;
    updateProgressBar(currentStep);
    if (selectedAssistant === "mayia") {
      loadFormForMayIA();
    } else {
      loadFormForSofIA();
    }
  }
  function agregarFaq() {
    const container = document.getElementById("faqContainer");
    const faqHTML = `
      <div class="faq-item" style="margin-top: 20px;">
        <label>Pregunta</label>
        <input type="text" class="faq-pregunta" placeholder="Ej: ¬øCu√°l es el horario de atenci√≥n?" />
        <label>Respuesta</label>
        <input type="text" class="faq-respuesta" placeholder="Ej: De lunes a s√°bado, de 9am a 6pm." />
      </div>
    `;
    container.insertAdjacentHTML("beforeend", faqHTML);
  }
  
  function volverPaso2() {
    currentStep = 2;
    updateProgressBar(currentStep);
  
    const esMayIA = selectedAssistant === "mayia";
  
    const objetivos = esMayIA
      ? [
          "Responder preguntas sobre productos",
          "Promocionar nuevos productos",
          "Guiar al cliente hacia la compra",
          "Enviar enlaces a tienda virtual",
          "Compartir precios y formas de pago",
          "Ofrecer recomendaciones de productos",
        ]
      : [
          "Responder dudas sobre servicios",
          "Automatizar reservas o agendamientos",
          "Confirmar citas autom√°ticamente",
          "Guiar al cliente al contacto por WhatsApp",
          "Promover servicios destacados",
          "Reducir el trabajo del equipo humano",
        ];
  
    dynamicContainer.innerHTML = `
      <h3>üéØ ¬øCu√°les son los objetivos de tu asistente?</h3>
      <p>Selecciona los objetivos que deseas lograr con <strong>${esMayIA ? "MayIA" : "SofIA"}</strong>:</p>
  
      <div class="objetivo-selection">
        ${objetivos
          .map(
            (obj) => `
            <div class="objetivo-option">${obj}</div>
          `
          )
          .join("")}
      </div>
  
      <label style="margin-top: 20px; display: block;">
        Otro objetivo:
        <input type="text" id="inputOtro" placeholder="Especifica tu objetivo" />
      </label>
  
      <div style="margin-top: 30px;">
        <button class="btn ca-btn-outline" onclick="volverPaso1()">‚Üê Regresar</button>
        <button class="btn" onclick="siguientePaso()">Siguiente</button>
      </div>
    `;
  
    document.querySelectorAll(".objetivo-option").forEach((opt) => {
      opt.addEventListener("click", () => {
        opt.classList.toggle("selected");
      });
    });
  }
  function volverPaso3() {
    currentStep = 3;
    updateProgressBar(currentStep);
  
    dynamicContainer.innerHTML = `
      <h3>‚ùì Preguntas frecuentes (FAQ)</h3>
      <p>A√±ade las preguntas que suelen hacer tus clientes y c√≥mo deseas que el asistente responda.</p>
  
      <div id="faqContainer">
        <div class="faq-item">
          <label>Pregunta</label>
          <input type="text" class="faq-pregunta" placeholder="Ej: ¬øCu√°nto cuesta el env√≠o?" />
          <label>Respuesta</label>
          <input type="text" class="faq-respuesta" placeholder="Ej: El env√≠o cuesta entre $8.000 y $12.000 seg√∫n tu ciudad." />
        </div>
      </div>
  
      <button class="btn ca-btn-outline" onclick="agregarFaq()">‚ûï A√±adir otra pregunta</button>
      <div style="margin-top: 30px;">
        <button class="btn ca-btn-outline" onclick="volverPaso2()">‚Üê Regresar</button>
        <button class="btn" onclick="siguientePaso()">Siguiente</button>
      </div>
    `;
  }
  function agregarProducto() {
    repliegueUltimoProducto(); // üîß Ajoute ici
  
    const container = document.getElementById("productosServiciosContainer");
    const block = document.createElement("div");
    block.classList.add("producto-item");
    block.style.marginTop = "20px";
    block.innerHTML = `
      <label>Nombre</label>
      <input type="text" class="producto-nombre" placeholder="Ej: Corte de cabello, Combo #2..." />
      <label>Precio</label>
      <input type="text" class="producto-precio" placeholder="Ej: $15.000" />
      <label>Descripci√≥n</label>
      <input type="text" class="producto-descripcion" placeholder="Ej: Corte moderno para hombre" />
    `;
    container.appendChild(block);
    actualizarCamposProducto(block); // Garde bien cette ligne aussi
  }
  // V√©rif auth
  window.addEventListener("DOMContentLoaded", async () => {
    try {
      const res = await fetch("/api/me", { credentials: "include" });
      if (!res.ok) throw new Error("No autenticado");
      const data = await res.json();
      document.getElementById("auth-buttons").innerHTML = `üëã Hola, ${data.name}`;
      showStep0();
  
      // üîÅ Ajoute ceci
      document.getElementById("mayia").addEventListener("click", () => {
        selectedAssistant = "mayia";
        document.getElementById("mayia").classList.add("selected");
        document.getElementById("sofia").classList.remove("selected");
      
        // Masquer l‚Äô√©tape 0
        document.getElementById("step0").style.display = "none";
      
        loadFormForMayIA();
      });
      
      document.getElementById("sofia").addEventListener("click", () => {
        selectedAssistant = "sofia";
        document.getElementById("sofia").classList.add("selected");
        document.getElementById("mayia").classList.remove("selected");
      
        // Masquer l‚Äô√©tape 0
        document.getElementById("step0").style.display = "none";
      
        loadFormForSofIA();
      });
  
    } catch (err) {
      window.location.href = "login.html";
    }
  });
    
  async function finalizarFormulario() {
    const rawData = generarDatosFormulario(); // üîç collecte toutes les valeurs
  
    // üëâ Tu construis ici le texte final √† partir de rawData
    const textoFinal = construirTextoFinal(rawData); // on verra ce helper ci-dessous
  
    const res = await fetch("/api/configurar-instrucciones", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "include",
      body: JSON.stringify({ instructions: textoFinal, rawData })
    });
  
    if (res.ok) {
      alert("‚úÖ Instrucciones actualizadas correctamente.");
    } else {
      alert("‚ùå Error al guardar las instrucciones.");
    }
  }
  function generarDatosFormulario() {
    const chkOtro = document.getElementById("otroObjetivo");
    if (chkOtro && chkOtro.checked) {
      datosFormulario.diasFestivos = true;
    } else {
      datosFormulario.diasFestivos = false;
    }
    const inputOtro = document.getElementById("inputOtro");
    
    const objetivos = Array.from(document.querySelectorAll('.objetivo:checked')).map(el => el.value);
    if (chkOtro.checked && inputOtro.value.trim()) {
      objetivos.push(inputOtro.value.trim());
    }
  
    const faqPairs = Array.from(document.querySelectorAll(".faq-item")).map(faq => ({
      pregunta: faq.querySelector(".faq-pregunta")?.value.trim(),
      respuesta: faq.querySelector(".faq-respuesta")?.value.trim()
    })).filter(faq => faq.pregunta && faq.respuesta);
  
    return {
      nombre: document.getElementById("nombreNegocio").value.trim(),
      tipo: document.getElementById("tipoNegocio").value.trim(),
      venta: document.querySelector('input[name="tipoVenta"]:checked')?.value || "",
      especialidad: document.getElementById("especializacion").value.trim(),
      clientes: document.querySelector('input[name="tipoCliente"]:checked')?.value || "",
      ciudad: document.getElementById("ciudad").value.trim(),
      objetivos,
      tono: document.getElementById("tono").value.trim(),
      estilo: document.getElementById("ejemploEstilo").value.trim(),
      faq: faqPairs,
      productos: document.getElementById("productosList").value.trim().split("\n").filter(Boolean),
      horarios: {
        lunes: document.getElementById("lunes").value.trim(),
        martes: document.getElementById("martes").value.trim(),
        miercoles: document.getElementById("miercoles").value.trim(),
        jueves: document.getElementById("jueves").value.trim(),
        viernes: document.getElementById("viernes").value.trim(),
        sabado: document.getElementById("sabado").value.trim(),
        domingo: document.getElementById("domingo").value.trim(),
        festivos: document.getElementById("trabajaFestivos").checked
      },
      web: document.getElementById("paginaWeb").value.trim(),
      whatsapp: document.getElementById("whatsapp").value.trim()
    };
  }
  function construirTextoFinal(data) {
    return `
  I/ Informaci√≥n del Asistente
  I.i/ Contexto
  ${data.nombre} es un negocio de ${data.tipo} y que vende ${data.venta}. 
  ${data.nombre} est√° especializado en la venta de ${data.especialidad}.
  Los clientes son principalmente ${data.clientes}.
  ${data.nombre} se encuentra en ${data.ciudad}.
  
  I.ii/ Objetivos
  Los objetivos principales de ${data.nombre} son:
  ${data.objetivos.map(o => "- " + o).join("\n")}
  
  I.iii/ Estilo de comunicaci√≥n
  El estilo de comunicaci√≥n de ${data.nombre} es:
  Tono: ${data.tono}
  Ejemplo: ${data.estilo}
  
  II/ Funciones
  II.i/ Preguntas frecuentes
  ${data.faq.map(f => `- ${f.pregunta}\n  ‚Üí ${f.respuesta}`).join("\n")}
  
  III/ Informaci√≥n del comercio
  III.i/ Informaci√≥n de los ${data.venta}
  ${data.productos.map(p => "- " + p).join("\n")}
  
  III.ii/ Horarios
  Lunes: ${data.horarios.lunes}
  Martes: ${data.horarios.martes}
  Mi√©rcoles: ${data.horarios.miercoles}
  Jueves: ${data.horarios.jueves}
  Viernes: ${data.horarios.viernes}
  S√°bado: ${data.horarios.sabado}
  Domingo: ${data.horarios.domingo}
  ${data.nombre} ${data.horarios.festivos ? "s√≠" : "no"} est√° abierto en d√≠as festivos.
  
  III.iii/ Contactos
  La p√°gina web principal es: ${data.web}
  El n√∫mero de WhatsApp es: ${data.whatsapp}
  
  IV/ Notas Internas para Clasificaci√≥n de Conversaciones
  Despu√©s de cada respuesta dirigida al cliente, debes agregar una nota interna de toda la conversaci√≥n estructurada que no ser√° visible para el cliente, pero ser√° utilizada para clasificar la conversaci√≥n en el sistema de Dolcezza.
  Esta nota debe seguir el siguiente formato exacto:
  
  --- Nota interna ---
  Resumen: [Una frase breve que resuma el prop√≥sito de la conversaci√≥n]
  Estado: [Una de las siguientes opciones: Acci√≥n requerida / Nada que hacer / Conversaci√≥n informativa / Potencial cliente / Seguimiento recomendado]
  ---------------------
  
  üìå Importante: Esta nota debe ir al final del mensaje, despu√©s de responder al cliente.
  ‚ö†Ô∏è No incluyas esta nota en el mensaje de WhatsApp al cliente. El sistema la detectar√° autom√°ticamente para uso interno.
    `.trim();
  }
  </script>
</body>
</html>
