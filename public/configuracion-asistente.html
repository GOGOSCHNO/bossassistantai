<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Configuraci√≥n del Asistente ‚Äì Comercio AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="comercioai.css">
  <link rel="icon" href="https://raw.githubusercontent.com/GOGOSCHNO/assistantai-site/refs/heads/main/images/favicon%20(2).png" type="image/x-icon">
</head>
<body>
  <div class="overlay">
    <header class="ca-header">
      <div class="ca-header-3col">
        <div class="ca-header-left">
          <a href="index.html" class="ca-logo-icon">
            <img src="https://raw.githubusercontent.com/GOGOSCHNO/assistantai-site/refs/heads/main/images/favicon%20(2).png" alt="Logo Cerveau">
          </a>
          <a href="index.html" class="ca-logo-text-img">
            <img src="https://raw.githubusercontent.com/GOGOSCHNO/bossassistantai/refs/heads/main/public/images/ComercioAI_logotexte%20sans%20fonds.png" alt="Logo ComercioAI">
          </a>
        </div>
        <nav class="ca-header-center" id="nav-center">
          <a href="precio.html" class="ca-btn nav-btn">Ver planes</a>
          <a href="dashboard.html" class="ca-btn ca-btn-primary">Dashboard</a>
        </nav>
        <div id="auth-buttons" class="ca-header-right"></div>
      </div>
    </header>

    <main>
      <div class="form-container">
        <h2>‚öôÔ∏è Configuraci√≥n del asistente</h2>

        <!-- √âTAPE 0 : S√©lection de l'assistant -->
        <div class="form-step" id="step0">
          <h2>¬øCu√°l asistente deseas usar?</h2>
          <div class="assistant-selection">
            <div class="assistant-option" id="mayia">
              <img src="https://via.placeholder.com/150x150.png?text=MayIA" alt="MayIA">
              <h3>MayIA</h3>
              <p>Ideal para negocios de productos f√≠sicos o digitales.</p>
            </div>
            <div class="assistant-option" id="sofia">
              <img src="https://via.placeholder.com/150x150.png?text=SofIA" alt="SofIA">
              <h3>SofIA</h3>
              <p>Perfecta para servicios como belleza, salud, reservas‚Ä¶</p>
            </div>
          </div>
        </div>
        <section id="seccion-informacion" class="form-step active">
          <h2>I. Informaci√≥n del Asistente</h2>
        
          <!-- I.i/ Contexto -->
          <div class="form-subsection">
            <h3>I.i/ Contexto</h3>
        
            <label for="nombreNegocio">El nombre de mi negocio es:</label>
            <input type="text" id="nombreNegocio" placeholder="Ej: Dolcezza, Enigma Medell√≠n...">
        
            <label for="tipoNegocio">Somos un negocio de:</label>
            <input type="text" id="tipoNegocio" placeholder="Ej: belleza, entretenimiento, gastronom√≠a...">
        
            <label>Vendemos:</label><br>
            <label><input type="radio" name="tipoVenta" value="productos"> Productos</label>
            <label><input type="radio" name="tipoVenta" value="servicios"> Servicios</label>
        
            <label for="especializacion">Nuestros <span id="etiquetaTipoVenta">productos/servicios</span> son principalmente:</label>
            <input type="text" id="especializacion" placeholder="Ej: cejas, micropigmentaci√≥n, salas de escape...">
        
            <label>Nuetros clientes son principalmente:</label><br>
            <label><input type="radio" name="tipoCliente" value="mujeres"> Mujeres</label>
            <label><input type="radio" name="tipoCliente" value="hombres"> Hombres</label>
            <label><input type="radio" name="tipoCliente" value="ambos"> Los dos</label>
        
            <label for="ciudad">Trabajamos en la(s) ciudad(es) de:</label>
            <input type="text" id="ciudad" placeholder="Ej: Medell√≠n, Bogot√°, Barranquilla...">
          </div>
        
          <!-- I.ii/ Objetivos -->
          <div class="form-subsection" style="margin-top: 30px;">
            <h3>I.ii/ Objetivos del asistente</h3>
            <p>¬øQu√© quieres que haga tu asistente IA? (selecci√≥n m√∫ltiple)</p>
            <label><input type="checkbox" value="responder dudas frecuentes" class="objetivo"> Responder dudas frecuentes</label><br>
            <label><input type="checkbox" value="vender productos o servicios" class="objetivo"> Vender productos o servicios</label><br>
            <label><input type="checkbox" value="redirigir a un sitio web" class="objetivo"> Redirigir a un sitio web</label><br>
            <label><input type="checkbox" value="recomendar opciones" class="objetivo"> Recomendar opciones</label><br>
            <label><input type="checkbox" value="agendar citas o reservas" class="objetivo"> Agendar citas o reservas</label><br>
            <label><input type="checkbox" value="gestionar pedidos" class="objetivo"> Gestionar pedidos</label><br>
            <label><input type="checkbox" value="otro" id="objetivoOtroChk"> Otro:</label>
            <input type="text" id="objetivoOtroInput" style="display: none;" placeholder="Describe otro objetivo...">
          </div>
        
          <!-- I.iii/ Estilo de comunicaci√≥n -->
          <div class="form-subsection" style="margin-top: 30px;">
            <h3>I.iii/ Estilo de comunicaci√≥n</h3>
            <label for="tono">Tono general del asistente:</label>
            <select id="tono">
              <option value="">Selecciona un tono...</option>
              <option value="profesional">Profesional</option>
              <option value="amigable">Amigable</option>
              <option value="divertido">Divertido</option>
              <option value="juguet√≥n">Juguet√≥n</option>
              <option value="formal">Formal</option>
            </select>
        
            <label for="ejemploEstilo">Ejemplo de estilo de respuesta:</label>
            <textarea id="ejemploEstilo" rows="2" placeholder="Ej: ¬°Claro! Puedes venir con tus amigos y vivir una experiencia inolvidable üî•"></textarea>
          </div>
        
          <button id="siguienteBtn" class="cta-button" style="margin-top: 30px;">
            Siguiente secci√≥n ‚Üí
          </button>
        </section>
        <!-- SECTION II: Preguntas Frecuentes -->
        <section id="seccion-preguntas" class="form-step" style="display: none;">
          <h2>II. Preguntas Frecuentes</h2>
          <div class="form-subsection">
            <p>Puedes a√±adir tus preguntas frecuentes y sus respuestas:</p>
            <div id="faq-container">
              <div class="faq-item">
                <label>Pregunta:</label>
                <input type="text" class="faq-pregunta">
                <label>Respuesta:</label>
                <textarea class="faq-respuesta" rows="2"></textarea>
              </div>
            </div>
            <button type="button" class="cta-button" id="agregarFaqBtn">‚ûï A√±adir otra pregunta</button>
          </div>
          <button type="button" class="cta-button" id="siguienteBtn2">Siguiente secci√≥n ‚Üí</button>
        </section>
        
        <!-- SECTION III: Informaci√≥n del comercio -->
        <section id="seccion-informacion-comercio" class="form-step" style="display: none;">
          <h2>III. Informaci√≥n del Comercio</h2>
        
          <div class="form-subsection">
            <label for="productosList">Lista de tus productos o servicios (uno por l√≠nea):</label>
            <textarea id="productosList" rows="4" placeholder="Ej: Cejas HD&#10;Micropigmentaci√≥n&#10;Limpieza facial..."></textarea>
          </div>
        
          <div class="form-subsection">
            <h3>Horarios de atenci√≥n</h3>
            <label for="lunes">Lunes:</label><input type="text" id="lunes" placeholder="Ej: 10:00‚Äì18:00"><br>
            <label for="martes">Martes:</label><input type="text" id="martes"><br>
            <label for="miercoles">Mi√©rcoles:</label><input type="text" id="miercoles"><br>
            <label for="jueves">Jueves:</label><input type="text" id="jueves"><br>
            <label for="viernes">Viernes:</label><input type="text" id="viernes"><br>
            <label for="sabado">S√°bado:</label><input type="text" id="sabado"><br>
            <label for="domingo">Domingo:</label><input type="text" id="domingo"><br>
            <label><input type="checkbox" id="trabajaFestivos"> Trabajamos los d√≠as festivos</label>
          </div>
        
          <div class="form-subsection">
            <h3>Datos de contacto</h3>
            <label for="paginaWeb">Mi p√°gina web principal es:</label>
            <input type="text" id="paginaWeb" placeholder="https://...">
        
            <label for="whatsapp">Mi n√∫mero de WhatsApp es:</label>
            <input type="text" id="whatsapp" placeholder="Ej: 573001234567">
          </div>
        
          <button class="cta-button" id="generarInstruccionesBtn" style="margin-top: 30px;">
            Generar instrucciones ‚ú®
          </button>
        </section>
      </div>
    </main>

    <footer class="ca-footer">
      &copy; 2025 Comercio AI ‚Äì Todos los derechos reservados.
      <a href="contacto.html">Cont√°ctanos</a>
      <a href="politica-de-privacidad.html" target="_blank">Pol√≠tica de Privacidad</a>
    </footer>
  </div>
  <script>
    let currentStep = 0;
    const steps = document.querySelectorAll(".form-step");
  
    function showStep(index) {
      steps.forEach((step, i) => {
        step.style.display = i === index ? "block" : "none";
      });
    }
  
    // Navigation boutons "Siguiente"
    document.getElementById("siguienteBtn").addEventListener("click", () => {
      currentStep = 1;
      showStep(currentStep);
    });
  
    document.getElementById("siguienteBtn2").addEventListener("click", () => {
      currentStep = 2;
      showStep(currentStep);
    });
    let selectedAssistant = null;
  
    document.getElementById("mayia").addEventListener("click", () => {
      selectedAssistant = "mayia";
      document.getElementById("mayia").classList.add("selected");
      document.getElementById("sofia").classList.remove("selected");
      goToNextStep();
    });
    
    document.getElementById("sofia").addEventListener("click", () => {
      selectedAssistant = "sofia";
      document.getElementById("sofia").classList.add("selected");
      document.getElementById("mayia").classList.remove("selected");
      goToNextStep();
    });
    
    function goToNextStep() {
      if (!selectedAssistant) return;
      currentStep = 1;
      showStep(currentStep);
    
      // Astuce : stocker le choix dans une variable globale pour adapter les √©tapes ensuite
      window.assistantElegido = selectedAssistant;
    }
    // Libell√© dynamique "productos/servicios"
    document.querySelectorAll('input[name="tipoVenta"]').forEach(radio => {
      radio.addEventListener('change', () => {
        document.getElementById('etiquetaTipoVenta').textContent = radio.value;
      });
    });
  
    // Afficher champ "otro" si coch√©
    const chkOtro = document.getElementById("objetivoOtroChk");
    const inputOtro = document.getElementById("objetivoOtroInput");
    chkOtro.addEventListener("change", () => {
      inputOtro.style.display = chkOtro.checked ? "block" : "none";
    });
  
    // Ajouter dynamiquement des blocs FAQ
    const faqContainer = document.getElementById("faq-container");
    document.getElementById("agregarFaqBtn").addEventListener("click", () => {
      const div = document.createElement("div");
      div.className = "faq-item";
      div.innerHTML = `
        <label>Pregunta:</label>
        <input type="text" class="faq-pregunta">
        <label>Respuesta:</label>
        <textarea class="faq-respuesta" rows="2"></textarea>
      `;
      faqContainer.appendChild(div);
    });
  
    // V√©rification utilisateur + affichage initial
    window.addEventListener("DOMContentLoaded", async () => {
      try {
        const res = await fetch("/api/me", { credentials: "include" });
        if (!res.ok) throw new Error("No autenticado");
        const data = await res.json();
        document.getElementById("auth-buttons").innerHTML = `üëã Hola, ${data.name}`;
        showStep(currentStep); // affiche section 1
      } catch (err) {
        window.location.href = "login.html";
      }
    });
  </script>
  <script>
    document.getElementById("generarInstruccionesBtn").addEventListener("click", async () => {
      // 1. R√©cup√©ration des champs Section I
      const nombre = document.getElementById("nombreNegocio").value.trim();
      const tipo = document.getElementById("tipoNegocio").value.trim();
      const venta = document.querySelector('input[name="tipoVenta"]:checked')?.value || "";
      const especialidad = document.getElementById("especializacion").value.trim();
      const clientes = document.querySelector('input[name="tipoCliente"]:checked')?.value || "";
      const ciudad = document.getElementById("ciudad").value.trim();
  
      const objetivos = Array.from(document.querySelectorAll('.objetivo:checked')).map(el => el.value);
      if (chkOtro.checked && inputOtro.value.trim()) {
        objetivos.push(inputOtro.value.trim());
      }
  
      const tono = document.getElementById("tono").value.trim();
      const estilo = document.getElementById("ejemploEstilo").value.trim();
  
      // 2. Section II ‚Äì FAQ
      const faqPairs = Array.from(document.querySelectorAll(".faq-item")).map(faq => {
        const q = faq.querySelector(".faq-pregunta")?.value.trim();
        const a = faq.querySelector(".faq-respuesta")?.value.trim();
        return q && a ? `- ${q}\n  ‚Üí ${a}` : null;
      }).filter(Boolean);
  
      // 3. Section III
      const productos = document.getElementById("productosList").value.trim().split("\n").filter(Boolean).map(p => `- ${p}`).join("\n");
      const horarios = [
        `Lunes: ${document.getElementById("lunes").value.trim()}`,
        `Martes: ${document.getElementById("martes").value.trim()}`,
        `Mi√©rcoles: ${document.getElementById("miercoles").value.trim()}`,
        `Jueves: ${document.getElementById("jueves").value.trim()}`,
        `Viernes: ${document.getElementById("viernes").value.trim()}`,
        `S√°bado: ${document.getElementById("sabado").value.trim()}`,
        `Domingo: ${document.getElementById("domingo").value.trim()}`,
      ].join("\n");
      const festivos = document.getElementById("trabajaFestivos").checked;
  
      const web = document.getElementById("paginaWeb").value.trim();
      const whatsapp = document.getElementById("whatsapp").value.trim();
  
      // 4. Construction du prompt
      const textoFinal = `
  I/ Informaci√≥n del Asistente
  I.i/ Contexto
  ${nombre} es un negocio de ${tipo} y que vende ${venta}. 
  ${nombre} est√° especializado en la venta de ${especialidad}.
  Los clientes son principalmente ${clientes}.
  ${nombre} se encuentra en ${ciudad}.
  
  I.ii/ Objetivos
  Los objetivos principales de ${nombre} son:
  ${objetivos.map(o => "- " + o).join("\n")}
  
  I.iii/ Estilo de comunicaci√≥n
  El estilo de comunicaci√≥n de ${nombre} es:
  Tono: ${tono}
  Ejemplo: ${estilo}
  
  II/ Funciones
  II.i/ Preguntas frecuentes
  ${faqPairs.join("\n")}
  
  III/ Informaci√≥n del comercio
  III.i/ Informaci√≥n de los ${venta}
  ${productos}
  
  III.ii/ Horarios
  ${horarios}
  ${nombre} ${festivos ? "s√≠" : "no"} est√° abierto en d√≠as festivos.
  
  III.iii/ Contactos
  La p√°gina web principal es: ${web}
  El n√∫mero de WhatsApp es: ${whatsapp}
  
  IV/ Notas Internas para Clasificaci√≥n de Conversaciones
  Despu√©s de cada respuesta dirigida al cliente, debes agregar una nota interna de toda la conversaci√≥n estructurada que no ser√° visible para el cliente, pero ser√° utilizada para clasificar la conversaci√≥n en el sistema de Dolcezza.
  Esta nota debe seguir el siguiente formato exacto:
  
  --- Nota interna ---
  Resumen: [Una frase breve que resuma el prop√≥sito de la conversaci√≥n]
  Estado: [Una de las siguientes opciones: Acci√≥n requerida / Nada que hacer / Conversaci√≥n informativa / Potencial cliente / Seguimiento recomendado]
  ---------------------
  
  üìå Importante: Esta nota debe ir al final del mensaje, despu√©s de responder al cliente.
  ‚ö†Ô∏è No incluyas esta nota en el mensaje de WhatsApp al cliente. El sistema la detectar√° autom√°ticamente para uso interno.
      `.trim();
  
      // 5. Envoi au backend
      const res = await fetch("/api/configurar-instrucciones", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ instructions: textoFinal })
      });
  
      if (res.ok) {
        alert("‚úÖ Instrucciones actualizadas correctamente en tu asistente.");
      } else {
        alert("‚ùå Error al guardar las instrucciones.");
      }
    });
  </script>
</body>
</html>
